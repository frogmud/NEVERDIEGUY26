{
  "version": "1.0.0",
  "generated": "2026-01-18T00:00:00.000Z",
  "description": "Regression baseline snapshots for state comparison. Run integration-runner.ts to regenerate.",
  "baselines": {
    "BASELINE-V1": {
      "seed": "BASE01",
      "loadout": "survivor",
      "startingDomain": 1,
      "expectedOutcome": "victory",
      "snapshots": {
        "run_start": {
          "phase": "playing",
          "currentDomain": 1,
          "gold": 0,
          "totalScore": 0,
          "scars": 0,
          "hp": 100,
          "heat": 0,
          "corruption": 0,
          "visitedDomains": [1],
          "inventory": {
            "powerupsCount": 0,
            "diceCount": 6
          },
          "explorationState": {
            "visitedCoords": [],
            "coordHitCounts": {},
            "templateHitCounts": {},
            "recentTemplateIds": [],
            "totalSelections": 0
          }
        },
        "combat_d1r1": {
          "phase": "playing",
          "currentDomain": 1,
          "gold": {
            "min": 50,
            "max": 150,
            "note": "Base gold reward for first room"
          },
          "totalScore": {
            "min": 800,
            "max": 1300,
            "note": "Score goal for domain 1 is ~800-1000"
          },
          "scars": 0,
          "hp": 100,
          "heat": 0,
          "explorationState": {
            "totalSelections": 1,
            "visitedCoords": {
              "min": 1,
              "max": 1
            }
          }
        },
        "domain_clear_1": {
          "phase": "playing",
          "currentDomain": 6,
          "gold": {
            "min": 150,
            "max": 500,
            "note": "After 3 rooms + shop interactions"
          },
          "scars": 0,
          "hp": {
            "min": 80,
            "max": 100,
            "note": "May take damage from travel"
          },
          "heat": 1,
          "visitedDomains": [1, 6],
          "inventory": {
            "powerupsCount": {
              "min": 0,
              "max": 3,
              "note": "Epic+ items persist, Common/Uncommon expire"
            }
          }
        },
        "game_over": {
          "phase": "game_over",
          "currentDomain": 5,
          "visitedDomains": [1, 6, 2, 3, 4, 5],
          "scars": {
            "min": 0,
            "max": 3,
            "note": "Victory should have <4 scars"
          },
          "totalScore": {
            "min": 15000,
            "max": 30000,
            "note": "Score accumulates across all domains"
          },
          "explorationState": {
            "totalSelections": {
              "min": 18,
              "max": 30,
              "note": "3 rooms * 6 domains = 18+ selections"
            },
            "visitedCoords": {
              "min": 10,
              "max": 25
            }
          }
        }
      }
    },
    "BASELINE-V2": {
      "seed": "BASE02",
      "loadout": "warrior",
      "startingDomain": 1,
      "expectedOutcome": "mid_game",
      "snapshots": {
        "run_start": {
          "phase": "playing",
          "currentDomain": 1,
          "gold": 0,
          "scars": 0,
          "hp": 100,
          "loadoutStats": {
            "fury": 20,
            "resilience": 15,
            "grit": 10
          }
        },
        "game_over": {
          "phase": "game_over",
          "currentDomain": 4,
          "scars": 4,
          "hp": {
            "min": 50,
            "max": 100,
            "note": "HP doesn't affect death at 4 scars"
          },
          "visitedDomains": {
            "note": "Should include [1, 6, 2, 3, 4] in progression order",
            "length": {
              "min": 3,
              "max": 5
            }
          }
        }
      }
    },
    "GOLD-CAP-TEST": {
      "seed": "MID003",
      "loadout": "survivor",
      "startingDomain": 1,
      "expectedOutcome": "mid_game",
      "description": "Tests gold cap enforcement (soft cap 500, hard cap 1000)",
      "snapshots": {
        "soft_cap_approach": {
          "gold": {
            "exact": 500,
            "note": "At soft cap, next gold gain is 50% of raw value"
          }
        },
        "soft_cap_exceeded": {
          "gold": {
            "min": 500,
            "max": 1000,
            "note": "Above soft cap, diminishing returns apply"
          },
          "validation": {
            "rule": "gold <= hardCap",
            "hardCap": 1000
          }
        },
        "hard_cap_reached": {
          "gold": {
            "exact": 1000,
            "note": "At hard cap, no more gold can be gained"
          },
          "validation": {
            "nextGoldGain": 0,
            "message": "Gold gain should be 0 when at hard cap"
          }
        }
      }
    },
    "EXPLORATION-STATE-TEST": {
      "seed": "MID004",
      "loadout": "mage",
      "startingDomain": 1,
      "expectedOutcome": "mid_game",
      "description": "Tests exploration state integration and bounds",
      "snapshots": {
        "after_first_combat": {
          "explorationState": {
            "visitedCoords": {
              "length": 1
            },
            "coordHitCounts": {
              "note": "Should have 1 entry with count=1"
            },
            "templateHitCounts": {
              "note": "Should have 1 entry with count=1"
            },
            "recentTemplateIds": {
              "length": 1
            },
            "totalSelections": 1,
            "validation": {
              "coordHitSum": "sum(coordHitCounts.values) === totalSelections",
              "templateHitSum": "sum(templateHitCounts.values) === totalSelections"
            }
          }
        },
        "after_10_selections": {
          "explorationState": {
            "recentTemplateIds": {
              "length": 10,
              "note": "Buffer should cap at 10"
            },
            "totalSelections": 10,
            "validation": {
              "bufferCap": "recentTemplateIds.length <= 10"
            }
          }
        },
        "game_over": {
          "explorationState": {
            "totalSelections": {
              "min": 9,
              "max": 18,
              "note": "3 domains * 3 rooms = 9 combats minimum"
            },
            "visitedCoords": {
              "min": 5,
              "max": 15,
              "note": "Coords accumulate but may repeat"
            },
            "validation": {
              "recentBuffer": "recentTemplateIds.length <= 10",
              "hitCountsMatch": "sum(coordHitCounts) === totalSelections"
            }
          }
        }
      }
    },
    "GRIT-IMMUNITY-TEST": {
      "seed": "EDGE05",
      "loadout": "survivor",
      "startingDomain": 1,
      "expectedOutcome": "early_death",
      "description": "Tests grit immunity one-time activation",
      "snapshots": {
        "before_first_fail": {
          "scars": 0,
          "gritImmunityUsed": false,
          "loadoutStats": {
            "grit": {
              "min": 20,
              "note": "Survivor has 20 grit (immunity threshold)"
            }
          }
        },
        "after_first_fail": {
          "scars": 0,
          "gritImmunityUsed": true,
          "phase": "playing",
          "note": "Grit immunity blocks first scar"
        },
        "after_second_fail": {
          "scars": 1,
          "gritImmunityUsed": true,
          "note": "Second fail adds scar (immunity already used)"
        },
        "game_over": {
          "scars": 4,
          "phase": "game_over",
          "gritImmunityUsed": true
        }
      }
    },
    "DOMAIN-PROGRESSION-TEST": {
      "seed": "EDGE01",
      "loadout": "warrior",
      "startingDomain": 4,
      "expectedOutcome": "mid_game",
      "description": "Tests non-standard domain progression (starting from Shadow Keep)",
      "snapshots": {
        "run_start": {
          "currentDomain": 4,
          "visitedDomains": [4],
          "note": "Starting from late-game domain"
        },
        "after_domain_4": {
          "currentDomain": 5,
          "visitedDomains": [4, 5],
          "validation": {
            "progressionOrder": "Domain 4 -> 5 (Shadow Keep -> Null Providence)",
            "note": "Domain order should match portal pools, not enforce [1,2,3...]"
          }
        },
        "game_over": {
          "visitedDomains": {
            "note": "Should NOT require [1,2,3...] prefix",
            "valid": [4, 5],
            "invalid": [1, 2, 3]
          }
        }
      }
    }
  },
  "validationRules": {
    "gold": {
      "softCap": 500,
      "hardCap": 1000,
      "diminishingRate": 0.5,
      "rule": "gold <= hardCap always, diminishing returns above softCap"
    },
    "scars": {
      "min": 0,
      "max": 4,
      "rule": "scars >= 4 triggers game_over"
    },
    "hp": {
      "min": 0,
      "max": 100,
      "rule": "HP can drop to 0 from travel but doesn't trigger death (scars do)"
    },
    "explorationState": {
      "recentTemplateIds": {
        "maxLength": 10,
        "rule": "Circular buffer, capped at 10 entries"
      },
      "totalSelections": {
        "rule": "Must equal sum of coordHitCounts and sum of templateHitCounts"
      }
    },
    "phase": {
      "validTransitions": {
        "lobby": ["playing"],
        "playing": ["game_over"],
        "game_over": ["lobby"]
      }
    },
    "visitedDomains": {
      "rule": "Tracks progression, no duplicates, order matters"
    }
  },
  "snapshotComparison": {
    "usage": "Compare snapshots from integration-runner.ts against these baselines",
    "tolerance": {
      "gold": "Allow +/- 10% variance for RNG in rewards",
      "score": "Allow +/- 15% variance for combat RNG",
      "explorationState.totalSelections": "Allow exact match or +1 (for async updates)"
    },
    "criticalFields": [
      "phase",
      "scars",
      "gritImmunityUsed",
      "visitedDomains",
      "gold <= 1000",
      "explorationState.recentTemplateIds.length <= 10"
    ]
  },
  "regressionDetection": {
    "howToUse": [
      "1. Run integration-runner.ts to generate current snapshots",
      "2. Compare current snapshots to baselines in this file",
      "3. Flag any critical field mismatches as regressions",
      "4. Update baselines if intentional changes were made"
    ],
    "example": {
      "baseline": {
        "gold": 500,
        "scars": 0
      },
      "current": {
        "gold": 1200,
        "scars": 0
      },
      "diff": "Gold exceeds hard cap (1000) - REGRESSION DETECTED"
    }
  }
}
